<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Agora Secure Call</title>
</head>
<body>
  <h1>ğŸ¥ ×‘×“×™×§×ª Agora SDK</h1>
  <div id="status">××—×›×” ×œ×”×ª×—×‘×¨×•×ª...</div>

  <script src="https://cdn.agora.io/sdk/release/AgoraRTC_N-4.20.0.js"></script>
  <script>
    let APP_ID = "";
    const CHANNEL_NAME = "test-room";

    // 1ï¸âƒ£ ×‘×§×©×ª APP_ID ×‘×¦×•×¨×” ×‘×˜×•×—×” ××”×©×¨×ª
    fetch('/appId')
      .then(res => res.json())
      .then(data => {
        APP_ID = data.appId;
        startCall(); // ×œ××—×¨ ×§×‘×œ×ª APP_ID â€“ ××ª×—×™×œ×™× ××ª ×”×©×™×—×”
      });

    async function startCall() {
      const client = AgoraRTC.createClient({ mode: "rtc", codec: "vp8" });

      document.getElementById("status").innerText = "××ª×—×‘×¨ ×œ×¢×¨×•×¥...";

      // 2ï¸âƒ£ ×‘×§×©×ª Token ×“×™× ××™×ª ××”×©×¨×ª (×›××• ×©×›×‘×¨ ×‘× ×™× ×•)
      const tokenRes = await fetch(`/rtc/${CHANNEL_NAME}/publisher/uid/0`);
      const tokenData = await tokenRes.json();

      await client.join(APP_ID, CHANNEL_NAME, tokenData.rtcToken, null);

      document.getElementById("status").innerText = "âœ… ××—×•×‘×¨";

      // ×”×ª×—×‘×¨×•×ª ×œ×•×•×™×“××•/××•×“×™×•
      const localTrack = await AgoraRTC.createMicrophoneAndCameraTracks();
      await client.publish(localTrack);
    }
  </script>
</body>
</html>
